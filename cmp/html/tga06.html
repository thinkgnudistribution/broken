<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC
	"-//W3C//DTD XHTML 1.1//EN"
	"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"
><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja"><head
><link rev="made" href="./"
/><link rel="contents" href="./"
/><title>Think GNU 第 6 回</title></head><body>
<ul>
<li><a href="../orig/copying">取り扱い注意</a></li>
<li><a href="tga07.html">次→</a></li>
<li><a href="tga05.html">←前</a></li>
<li><a href="tga00.html">まえがき、目次</a></li>
<li><a href="../">(HTML版)Think GNU配布</a></li>
</ul>
<hr/>
<h1>Think GNU 第 6 回</h1>
<h2>□カスタマイズのしやすさと圧縮プログラム□</h2>

<p>CUJJ#10/'90.7.18 発売号掲載</p>


<h3 id="h.0">0. はじめに</h3>

<p>　公私ともに切迫感がだいぶ高まってきた。半端じゃない。会社の組織が変わりつつあって落ちつかない最中に、夏の USENIX に出発するので、ありとあらゆる予定が前倒しになっている。「GNU ダイジェスト」の日本語訳も USENIX で配布するのでこの時期に行なう。渡米の準備もしなければならない。そんなわけで、CUJJ の原稿もここ半月の間に 2 回分を仕上げなければならないことが判明した。帰ったら帰ったで、ほとんど毎晩終電で帰宅しても、あたりが明るくなるころまでは床につけない今日このごろである。それこそ盆と正月が一緒にやってきたような忙しさである。いったいいつになったら眠れるのやら……。やはり渡米の飛行機の中かもしれない。プロジェクト GNU に染まって以来、このような忙しさが半年に 1 度は訪れるサイクルになっているので、精神的にはさほどプレッシャーを感じていないのがせめてもの救いである。<a href="#n.a">◆1</a></p>

<h3 id="h.1">1. カスタマイズ、あれこれ</h3>

<p>　以前は特にスケジュール管理をしなくても予定を記憶できるぐらい予定がなかったが、今では日程を覚えきれなくなった。もうスタック・オーバーフローになるほど予定が増えたのか、記憶の容量が少なくなったのか ?　とにかく何かに書き留めておかねばならなくなった。昔は流行のシステム手帳を使っていたが、ワークステーションのディスプレイの前に座っている時間が多くなった現在では、自社製 X Window スケジュール管理ツールを用いてチェックするようになった。これには次のような機能がある。</p>

<ul>
<li><p>カレンダー</p></li>
<li><p>1 日の時間単位のスケジュールの表示</p></li>
<li><p>スケジュール入力、編集機能 (日本語ももちろん扱う)</p></li>
<li><p>ほかの人のスケジュール表示機能</p></li>
</ul>

<p>　使い込んでくると、このツールのレイアウトをちょっと変えたいとか、表示の順序を少し入れ換えたいと思うようになる。そのためには C 言語で書かれたソース・プログラムを解析しなければならない。そしてコンパイル、リンクという運びになる。しかし、途中でバグが入り込めば、そのサイクルが 1 度ですまない、と考えるとやはりカスタマイズ用の言語が欲しくなる。</p>
<p>　ソース・プログラムの修正から実行までの開発サイクルの短縮を狙ったものが最近、ニュース (uunet の電子掲示板) に投稿された。<a href="#r.d">★4</a>　それは AWL(Another Widget Language) という名前の、コンパイラ・インタープリタで、X Window System 用のライブラリの部分を記述する目的で作成された。ちなみに、X ではライブラリよりさらに大きく、オブジェクト指向的な特徴をライブラリに入れたひとまとまりを widget(ウィジェット) と呼んでいる。</p>

<h4>1-1.AWL という名の言語</h4>

<p>　C 言語で書かれたプログラムを X のような大きなウィンドウ・システムのライブラリとリンクしようとすると、それだけで時間がかかり、さらに試行錯誤 (error&amp;retry) にも時間を費やし、おまけに記述性もそれほど良くはない。この AWL という言語はウィンドウ操作のために記述性の良いものを提供し、その言語で書かれたものと C 言語で書かれたものをリンクして、移行性を失わないようにしている。しかも、中間言語を使ったコンパイラ・インタープリタ方式を採用してリンクの時間を短縮している。言語仕様は C に近く、既存の C ソース・ファイルとリンクされる。ちなみに AWL であって AWK ではないのでお間違えなく。</p>
<p>　このプログラムには技術的に面白い点がある。中間コードを解釈していて、かつ C コードとのリンクが可能なことである。これならば C 言語のインタープリタを作成する上で大変参考になる、とひらめいた次第である。以前ボストンで gcc を改良して GNU C インタープリタを設計しながら試作を行なっていた時期に、既存の C 言語で書かれているオブジェクトとリンクさせるための方法と内部構造の設計が大変であった。冒頭の理由から、まだ AWL のソース・コードは調べていない。これからの課題である。</p>
<p>　AWL は最近出てきたものであるが、既存のものにも開発のしやすさを狙ったものがある。X 用の応用プログラムの中で、カスタマイズの容易性があって有望そうなものに Common Lisp の採用が挙げられる。その Common Lisp で記述された商品ソフトウェアやコピー・フリーになっているソフトウェアが何種類かある。例えば、Common Window や CLX などが挙げられるが、いずれも規模が大きい。<a href="#n.b">◆2,3</a></p>

<h4>1-2.X Window System のウィンドウ・マネージャのカスタマイズ</h4>

<p>　X の場合、さまざまなウィンドウ・マネージャから自分の気に入ったものを選び、自分なりにカスタマイズして使うことができる。それに対して Macintosh を考えてみると、ウィンドウ・マネージャは基本的に 1 種類だけであり、プルダウン・メニュー <a href="#n.d">*1</a> のタイプである。X の面白そうなウィンドウ・マネージャとして GWM <a href="#r.a">★1</a> がある。これは Lisp ライクな拡張言語を備えており、X サーバ上で動作しているそれぞれのクライアントを管理する。以前に紹介したマルチスクリーン・バージョン Epoch と組み合わせて使うと有効性が発揮できるとのこと。どういうふうに有効なのかは、はっきりわからない。やはり実際にインストールして使ってみなければ始まらない。</p>
<p>　Epoch は GNU Emacs をベースにしている言語である。ようやく先月から Epoch の日本語化バージョン Nepoch を使い始めている。面白そうだとわかっていながら、次のステップとして GWM を併せて使ってみるところまで至っていない。もう頭が堅くなってしまったのか。何をするにも億劫という年になったわけでもないのに。</p>

<h4>1-3. 再びスケジュール管理ツール</h4>

<p>　スケジュール管理プログラムのカスタマイズの容易性を狙って、Emacs の方でスケジュール管理パッケージを作ろうかと思ったら、もう既に次のようなものを作っていた人がいた。</p>

<p>パッケージ名    calender.el</p>
<p>作成者          Edward M. Reignold</p>
<p>概　要          GNU Emacs には cal.el という単純なカレンダー表示ライブラリが入っているが、それの拡張版</p>
<p>機　能</p>
<ul>
<li><p>カレンダーとメモ・ファイルの表示</p></li>
<li><p>時間単位ではなく、日単位の表示</p></li>
<li><p>メモ・ファイル入力機能はないので、エディタで入力する必要がある。</p></li>
<li><p>休日の表示機能、メモ・ファイルのプリント機能</p></li>
</ul>

<p>　このパッケージの欠点を次に示す。</p>

<ul>
<li><p>時間単位のスケジュールの表示機能がない。</p></li>
<li><p>メモ・ファイルの入力サポート機能がない。</p></li>
<li><p>ユーザ・インタフェースが良くない。</p></li>
<li><p>見た目が美しくない。</p></li>
</ul>

<p>　さらに GNU Emacs をベースにしているために、GNU Emacs の次のような欠点も継承している。</p>

<ul>
<li><p>フォントが複数使えない。</p></li>
<li><p>スクロール・バーやボタン、メニューをほとんどサポートしていない。<a href="#n.e">◆4</a></p></li>
</ul>

<p>　利点としては次のようなものがある。</p>

<ul>
<li><p>ソース・プログラムが Emacs Lisp で書かれているために短い。</p></li>
<li><p>自分で容易に修正ができるくらいの小規模のシステムである。</p></li>
<li><p>カスタマイズとローカライズが 2 つのレベルで可能である。1 つは変更しやすいように、変数や定数にまとめてユーザに提供し、スタートアップ・ファイルで修正する方法である。もう 1 つは Emacs Lisp を直接修正する方法である。Emacs Lisp は 1 行で行なえる仕事量が大きく、比較的読みやすいので修正も容易である。</p></li>
</ul>

<p>　C 言語で作成した X Window System ベースのプログラムには次のような特徴がある。</p>

<p>利点</p>
<ul>
<li><p>見た目が良い。</p></li>
<li><p>X 機能を全て生かせる (マルチフォント、スクロール・バー、ボタン、メニューのサポートが可能である)。</p></li>
</ul>

<p>欠点</p>
<ul>
<li><p>修正に要する工数が多い (例えば見ばえの修正に手間がかかる)。</p></li>
</ul>

<p>　この比較結果から、GNU Emacs が完全に X Window System をサポートすればおおかたの問題は解決される。逆に C 言語で書かれたもののカスタマイズの容易性を上げるためには前述の AWL を使ってみるのも 1 つの方法であろう。プロジェクト GNU では GNU Emacs の次のバージョンを作成中である。</p>

<h3 id="h.2">2. 昔の Emacs 環境</h3>

<p>　Emacs には gcc、gdb に次いで思い入れがある。というのは、だいぶ以前から Emacs をぜひ使ってみたいと思っていたからである。大学時代に、OA 関係の論文の中で Emacs に関するものがあった。それが頭にこびりついて離れなかった。会社に入社したころ、同期の人間の中に Emacs(Gosling Emacs) を学生のころに使っていた人がいた。その人から Emacs の機能を聞きマニュアルを見せてもらって、多くの有用な機能を備えていることが改めて理解できた。当時、会社で使っていたマシンはスーパー・ミニコンピュータと呼ばれる DEC VAX-11/780 と 750 であった。<a href="#n.f">◆5</a></p>
<p>　この DEC VAX-11/780 は今では MIPS 原器 (1MIPS の基準) と呼ばれてもいいほどのマシンである。最近のワークステーションやマイクロプロセッサの性能を示すのに、あるプログラムの実行時間を VAX-11/780 との比較結果で表現しているケースがある。一番多いのが、Dhrystone というプログラムを採用する場合である。これはもともと Ada という言語で書かれた計算機の性能テスト・プログラムではあるが、むしろ文字列処理が一様に含まれていてそのオペレーションの数がわかっているプログラムと言った方がその性格がわかりやすいだろう。それが Pascal や C 言語、Lisp にまで書き直され、ベンチマーク・テスト・プログラムとして用いられるようになったわけである。</p>
<p>　会社でも Gosling Emacs を導入することになり、マニュアルを読んで勉強した。その表紙には Unicorn(一角獣) が描かれていたのが印象的であった。覚え始めは緊張した。1 つのミス・オペレーションでファイル全ての内容を失うこともしばしば経験したからである。その後のバージョンアップで Undo 機能が追加され、安心して使えるようになった。Undo とは、実行したあるコマンドを無効にし、そのコマンドを実行する前の状態に戻す機能である。</p>
<p>　そのころ、「Dr. Dobb's Journal」(パーソナル・コンピュータ向けの米国の月刊誌で通称 DDJ) に「GNU Manifesto」(GNU 宣言) の記事が紹介されて、同じ部署の人が GNU Emacs を使い始めたが、Undo の機能がない点と Gosling Emacs とキー・バインディング (コマンドのキー割当) が微妙に違うといった点に難点があった。加えて、当時の GNU Emacs はバージョン 17 で安定していなかった。ちょっと使っただけでコアダンプ <a href="#n.h">*2</a> してしまった。そのためになかなか GNU Emacs に移行するチャンスがなかった。<a href="#n.g">◆6</a></p>
<p>　当時の Emacs 使用者に対する世間の目には厳しいものがあった。つまり 1 台のマシンを複数の人間が TSS(時分割、Time Sharing System) で使っていたので、1 人だけ CPU リソースを占有するとそれ以外の人から反感を持たれる。Emacs を使い始めたころは DEC VT100 を端末として使い、その後 VT220 へと移行していった。一画面が 24 行しかないので、通常はウィンドウを 2 つに分けて Emacs を使っていた。日中の 1 時から 3 時ころまでが CPU の使われ方のピークであった。ロードアベレージは 10〜20 が普通で 30 を越えることもままあった。30 を越えるともう仕事にならず、机上作業に移り、ロードアベレージが下がるのを待つ。そんな時にログインしようものなら、ログイン・プロンプトが出るまで 2〜3 分かかってしまう。</p>
<p>　Unix の世界ではマシンの混み方の度合いを測る尺度にロード・アベレージというものがある。Unix の w コマンドを使うと、1 分、5 分、15 分間の実行プロセスの待ち行列の平均ジョブ数を表示する。これがロードアドレスである。</p>
<p>　例えば、1 台のワークステーションにユーザが 1 人で編集していると数値は 0.1 ぐらいだが、それが 4〜5 人ほどで時々コンパイルするようになると途端にロード・アベレージは 2〜3 にはね上がるという具合である。</p>
<p>　計算機関係のどの分野でも言えることだが、今から考えると隔世の感がある。今は昔の話であった。</p>

<h3 id="h.3">3.GNU 史探訪</h3>

<p>　だいぶ現在に近くなり、Richard との接点があらわれる。おそらく、DECUS(DEC のユーザ会) のシンポジウムに招待され発表の合間に我が勤め先に寄ったものと思われる。筆者はそのころ三田方面に出向していたが、会社に戻っているときに Richard Stallman が会社にやってきた。筆者はちょっと挨拶をして、rms からオープン・リールのテープを借りて、内容をマシンにコピーした。借りたテープには gcc の初期バージョン (おそらくバージョン 1.3 だったと思う) が入っていた。rms 曰く、作業中のものなのでいくらかバグがあるとのこと。さっそく Sun-3 で動かしてみた。そのころの gcc のサポート・マシンは VAX と Sun のみであった。会社ではそろそろワークステーションの時代を迎えつつあった。手近なマシンである SONY NEWS に gcc を移植しようと決意し、少しずつ作業を進めた。というのは、偶然にも、これよりも前にこのマシンに Franz Lisp の移植をして、SONY NEWS のシステム・コールや C コンパイラのコード生成の概略を押さえていたので、そのノウハウが効を奏していたためである。</p>
<p>　こんな発端から GNU の世界にのめり込むことになった。</p>


<p>プロジェクト GNU 歴史年表</p>

<pre>
年　代　       出　来　事
1987/2     UNIX Review 誌より岸田 ((株)SRA) へのインタビュー
           同社より、日本で初めての GNU への援助金寄付
1987/4     gcc バージョン 1.4 リリース
           Richard M. Stallman 来日 (東京、大阪)
           gcc の SONY NEWS への移植開始
1988/2     各種 GNU ソフトウェアやマニュアルのリリース
             Make、ANSI C ライブラリ、Ghostscript、termcap マニュアル、
             gprof、GNU Emacs 18.51、gdb(32k 用)、gcc(32k, VMS, NEWS 用)
             G++(GNU C++) の作成開始
1988/2〜4  UCB 向け SPUR 用 gcc の開発
1988/3(〜'90/2)
           (株)SRA より物・人・金の援助
1988/4     gcc の SONY NEWS への移植
1988/5     各種 GNU のリリース
           Bison マニュアル、G++、gas(GNU Assembler、VAX, 68k 用)、gawk、
           gcc 386、gdb COFF、GDB+、GNU Emacs(30 種類以上のマシンで動作)、
           GhostscriptX、make、T(Scheme コンパイラ)、flex、grep、ld、ls
1988/6    (株) ソニーよりマシンの援助
1988/ 初秋 NeXT 社が初めて、GNU Emacs と gcc、gas、ld gdb を
           基本システムとして採用
1988/10    gdb の SONY NEWS への移植
1989/1     GDB+ の gdb への組み込み
           各種 GNU ソフトウェアのリリース
             4.3BSD tahoe、bison、gawk、gcc、gdb、GNU Emacs Manual、
             Ghostscript、gnuplot、Make、OOPS、texinfo、finger、
             libg++、mailer、send、tar、termcap、texi2roff
1989/8     MIT から正式にプロジェクト GNU 用の場所 (作業部屋) を提供
</pre>

<h3 id="h.4">4.　アーカイブ・プログラムの周辺</h3>

<p>　Unix の世界だけに限ると、アーカイブ・プログラムには次のようなものが存在した。tp は DEC のミニコンピュータに非常に依存したもので、現在では使われていない。tar はおそらく一番広く使われており、dump はハードディスクのダンプに、cpio は Unix System V 系でよく使われている。</p>

<p>tp、tar、dump、cpio</p>

<p>　プロジェクト GNU では GNU tar を広く使っている。GNU tar はもともと PDS(Public Domain Software) として配布されていたが、プロジェクト GNU でそれを取り込み、独自の拡張とバグ修正を施して copyleft で保護し、現在に至っている。</p>

<h4>4-1.GNU tar</h4>

<p>　よく使うオプションにアーカイブ・ファイルを圧縮する-Z または-z がある。それ以外にも数々の特徴があるので主なものを次にご紹介する。詳細は補遺の「GNU tar のオプション一覧」を参照のこと。</p>

<ul>
<li><p>ハードディスクのダンプにも使用可能 (フルダンプ、差分ダンプ)</p></li>
<li><p>マルチボリューム・アーカイブにも対応する。<a href="#n.i">◆7</a></p></li>
<li><p>アーカイブの内容とハードディスク上のファイルを比較するオプションがある。</p></li>
<li><p>操作対象ファイルをコマンド行以外から (標準入力やファイルから) も与えられる。</p></li>
<li><p>特定のファイルを、操作対象から外すことができるオプションがある。</p></li>
<li><p>疎なファイルを場所をとらずにまとめる方法を提供している。</p></li>
</ul>

<h4>4-2. ファイル圧縮プログラム</h4>

<p>　GNU tar でも採用されている圧縮プログラムを少し考えてみたい。圧縮プログラムの適用範囲を考えると、一般のディスク上のファイルだけでなくさまざまな分野、あるいは特定の分野が対象になってくる。</p>
<p>　例えば、画像ファイルを対象にしたアルゴリズム、ファックス用のもの、音声ファイルを対象としたもの、動画用 (最初の画面さえ送っておけば、動画の差分だけを送って転送情報の削減を狙った方法など)、モデム用などがある。</p>

<h4>4-3. 圧縮の考え方</h4>

<p>　基本的な考え方は、入力ファイルの中で出現頻度の高いコード (一般に文字ごとに扱うためバイト単位) に短い符合を割り当て、出現頻度の低いコードには長い符合 (ハフマン・コード、huffman code) を割り当てるというアイデアである。</p>
<p>　これをそのままアルゴリズム化すれば圧縮プログラムはできあがるわけである。つまり、ファイルを最初から最後まで読み込んでそれぞれのコードの出現順序を調べるという仕組みである。出現順序の高いコードから短い符合を割り当てて出現コードの全ての符合割り当てを行なう。しかしながら、ファイルを全て読み込まないと処理できないという欠点がある。これは Unix の pack コマンドで採用されているアルゴリズムである。<a href="#r.f">★6・7</a></p>
<p>　それを改良したアルゴリズムが適応型ハフマン符合化で、これは変換表をダイナミックに作っていく方法である。Unix の compact で採用されている方法である。</p>
<p>　コードごとに符合化していくわけであるが、コード間の冗長性を加味した方法が LZW(Lempel, Ziv, and Welch) アルゴリズムで、簡単な方法でコード間の冗長性を取り除いている。これは Unix の compress で使用されているアルゴリズムである。</p>
<p>　その他に、Miller-Wegman 符合化アルゴリズム<a href="#r.h">★8</a> を使った squeeze という圧縮プログラムがニュース (uunet の電子掲示版) に流れていた。</p>

<h4>4-4. 圧縮プログラムの種類</h4>

<p>　圧縮プログラムにはさまざまな種類があるが、どういうわけか、Unix の世界では compress/uncompress しか見かけない。それ以外にも少しある。Unix の世界では昔、compact/uncompact が使われていた。例えば、foo というファイルを compress すると foo.Z という圧縮ファイルになる。Z という拡張子を自動的につける。compact の場合は C であった。</p>
<p>　そういえば POSIX の規格の中にも compress/uncompress が入っていて、その仕様を提供しているのではなく、プログラム自体を提供している唯一のコマンドであった。</p>
<p>　パーソナル・コンピュータの世界で多用されている LHarc は Unix マシンにも移植されている。Unix の世界ではこれ以外の圧縮プログラムとして、ネットワークに流れていた squeeze/unsqueeze というプログラムがある。Unix 上で使ってみた結果、次のことがわかった。</p>
<p>　compress は圧縮もそこそこで実行時間も短く、LHarc は compress より 20〜30% くらい圧縮効率が良くなるが、実行時間が 5 倍遅くなる場合がある。squeeze は LHarc に近い圧縮効率と compress に近い実行速度を備えているが消費メモリが 9M バイトに及ぶこともある。squeeze の圧縮率は LHarc に匹敵し、実行速度は compress に近い。しかし最大の欠点は、メモリを多く消費することである。ダイナミックにメモリを割り当てていないので、固定の大きさのエリアを持つ。実行時のメモリ使用量は 9M バイトに及ぶ。</p>

<p>表  圧縮プログラムの種類</p>

<pre>
プログラム名       開発者
---------------+----------------
arc/arc            SEA
arc/arce           SEA
pkarc/pkxarc       PKware
pkpak/pkunpak      PKware
pkzip/pkunzip      PKware
larc               三木和彦ほか
</pre>

<h3 id="h.5">5. 今月のニュース</h3>

<p>　GNU Smalltalk の更新や GNU Emacs 上で動作する電卓パッケージが作成された。また、GNU 一般公的使用許諾に則ったドキュメンテーション・ツール LaTeXinfo がリリースされた。これは texinfo と同様に TeX の GNU 用マクロで、プリンタ出力用とオンライン表示用の両方を 1 つのテキスト・ファイルで実現するが、texinfo 固有のコマンドで記述しなくても LaTeX で使っているコマンドをそのまま記述して、同様の 1 テキスト・ファイルでハードコピーとオンラインの統合化をはかったツールである。<a href="#n.j">◆8</a></p>

<h4>5-1.GNU Emacs 用電卓 (GNU Calc)</h4>

<p>　HP-28 電卓の機能をほぼ網羅した GNU Emacs 上で動作する電卓がリリースされた。<a href="#n.k">◆9</a></p>

<dl>
<dt>●特徴</dt>
<dd>
<ul>
<li><p>中置記法、または RPN(逆ポーランド記法) のスタイルの選択</p></li>
<li><p>任意の倍精度整数と浮動小数点数</p></li>
<li><p>有理数を扱った数学や複素数 (直交座標や極座標)、標準偏差を使ったエラー形式、ベクターや行列、簡単な数式処理</p></li>
<li><p>対数や三角関数のような数学関数</p></li>
<li><p>プログラマ用の機能 (ビット方式のオペレーション、10 進数以外の整数)</p></li>
<li><p>整数論的な機能、例えば因数分解や任意の数 M を法とした演算<a href="#n.l">◆10</a></p></li>
<li><p>標準の編集バッファの削除やそのバッファから / へのコピー</p></li>
<li><p>キーボード・マクロや数式、Lisp を使った簡単なプログラミング</p></li>
<li><p>GNU texinfo 形式で記述された完全なマニュアル</p></li>
</ul>
</dd>
<dt>●入手方法</dt>
<dd>
<p>　次の方法でアクセスするか、または 1〜2 カ月後にニュース・グループ alt.source か comp.sources.misc に投稿される (予定) のを待つ。</p>
<p>方　法      anonymous ftp</p>
<p>マシン名    csvax.caltech.edu</p>
<p>ファイル名  pub/calc ディレクトリの下</p>
</dd>
</dl>
<h4>5-2.GNU Smalltalk(バージョン 1.1)</h4>

<dl>
<dt>●特徴</dt>
<dd>
<ul>
<li><p>X Window System との簡単な Smalltalk インタフェース</p></li>
<li><p>GNU Emacs 上でのインクリメンタルなソース・コードのコンパイルや実行</p></li>
<li><p>バイナリ・イメージ・ファイルは大幅に減少</p></li>
<li><p>エラーの取り扱いや復旧の改善</p></li>
<li><p>現在注目しているディレクトリに代わり、サブディレクトリでインストールする。</p></li>
<li><p>マニュアルの改善</p></li>
</ul>
</dd>
<dt>●動作するマシン</dt>
<dd>

<pre>
　　Apollo 3000/4000/10000
　　Atari ST
　　ECStation 3100
　　Encore Multimax
</pre>

<p>　　HP 9000/300 シリーズ、9000/800 シリーズ</p>
<p>　　Interactive 386 System V.3</p>
<p>　　SONY NEWS 1800 シリーズ</p>
<p>　　Sun-3、Sun-4</p>

<pre>
　　NeXT
　　Pyramid
　　Sequent
　　SGI Iris-4D
　　Tektronix 431[5-7]
　　VAX
</pre>

</dd>
<dt>●入手方法</dt>
<dd>
<p>方　法      anonymous ftp</p>
<p>マシン名    prep.ai.mit.edu</p>
<p>ファイル名  pub/gnu/smalltalk-1.1.tar.Z</p>
</dd>
<dt>●提案やバグ報告先</dt>
<dd>
<p>　電子メールにて bug-gnu-smalltalk@prep.ai.mit.e へ。</p>
</dd>
</dl>
<h4>5-3.LaTeXinfo(バージョン 1.2)</h4>

<p>　GNU Emacs バージョン 18 に対応している。</p>

<dl>
<dt>●特徴</dt>
<dd>
<ul>
<li><p>LaTeX に用意されている各種の書式マクロ documentstyle(article、report、book、twoside など) をサポートする。</p></li>
<li><p>エラー・チェックを行ない、エラー・メッセージもわかりやすい。</p></li>
<li><p>LaTeX の記述方式である引数を中括弧 { } で囲む書式を採用しているので、LaTeXinfo コマンドの開始と終了が判別しやすい。</p></li>
<li><p>オンライン・マニュアルへ変換するプログラム (latexinfo.el) で解釈できない LaTeX コマンドは無視されるので、オンライン (info) に変換する途中で発生するエラーをユーザが気にしなくてもよい。</p></li>
<li><p>ユーザ固有のオンライン・マニュアル生成プログラムを作成する場合は、その拡張部分に対応する GNU Emacs ハンドラを書くだけでよい。ユーザ用のスタイル・ファイルをモジュール化しやすい。</p></li>
<li><p>BibTeX(引用文献清書プログラム) を組み込むことができる。</p></li>
</ul>
</dd>
<dt>●入手方法</dt>
<dd>
<p>　uunet の comp.emacs、comp.test、gnu.emacs というニュース・グループにソース・コードが投稿されていた。</p>
</dd>
<dt>●提案やバグ報告先</dt>
<dd>
<p>　電子メールにて mike@ists.ists.ca へ。</p>
</dd>
</dl>
<h3 id="h.6">6. おわりに</h3>

<p>　ようやく今、この原稿と「GNU ダイジェスト」翻訳・加筆、およびコピー200 部 (USENIX コンファレンス配布用) の作成が終わった。</p>
<p>　今回はカスタマイズについて考えていることをまとめてみた。Emacs の昔話を「GNU の歴史」の前に加えてみたが懐かしい思いでいっぱいである。アーカイブ・プログラムと圧縮アルゴリズムについてざっと書き、最後に GNU tar のコマンド一覧を示した。GNU tar の英文マニュアルはわかりにくいため、今回の付録では少しでもわかりやすくなるように努めた。英文のマニュアルのわかりにくさはプロジェクト GNU でも認めていて、最新「GNU's Bulletin」によると全面的に書き直しているようである。それでは Richard のチュートリアルが楽しみな USENIX コンファレンスに行ってきます。</p>

<h2>参考文献</h2>
<dl>
<dt id="r.a">★1</dt><dd><p
>P.D.Stallmen「Free Software の世界 9、GWM-Generic Window Manager」「UNIX MAGAZINE」1990 年 5 月号、アスキー</p>
</dd>
<dt id="r.b">★2</dt><dd><p
>宮尾正大「PDS の中の言語」「インターフェース」1989 年 7 月号　別冊付録、CQ 出版社</p>
</dd>
<dt id="r.c">★3</dt><dd><p
>Jay Fenlason,　&quot;The GNU tape archive&quot;, DRAFT, Free Software Foundation, GNU tar バージョン 1.08 内に含まれているドキュメント</p>
</dd>
<dt id="r.d">★4</dt><dd><p
>Jordan K.Hubbard,　&quot;AWL Another Widget Language&quot;,1 January 1990, version 0.9β, AWL の配布ソース・プログラムに含まれているドキュメント</p>
</dd>
<dt id="r.e">★5</dt><dd><p
>Steve Wright「Interview 岸田孝一、Σを語る」「UNIX MAGAZINE」1987 年 8 月号、アスキー</p>
</dd>
<dt id="r.f">★6</dt><dd><p
>栗田多喜夫「コンピューティングの玉手箱 (41) ファイル圧縮」「bit」1988 年 5 月号、共立出版</p>
</dd>
<dt id="r.g">★7</dt><dd><p
>T.A.Welch,&quot;A Technique for High-Performance Data Compression&quot;, IEEE COMPUTER, Vol.17, No.6, pp.8〜9(1984)</p>
</dd>
<dt id="r.h">★8</dt><dd><p
>Victor S. Miller,&quot;Data Compression Algorithms&quot;,Proceeding of Symposia in Applied Mathematics, Vol.34(1986)</p>
</dd>
</dl>


<h3 id="addendum">〈補遺〉GNU tar のオプション一覧</h3>

<p>　以下に全ての GNU tar コマンドのリストを示す。これは文献<a href="#r.c">★3</a> を参考にした。最近の GNU ソフトウェアと同様に「長いオプション名」の機能もサポートしている。これまでの慣習に合わせて同じ 1 文字で示すオプションを最初に示し、「長いオプション名」を括弧内に示す。<a href="#n.m">◆11</a></p>

<dl>
<dt>●基本オプション</dt>
<dd>
<p>　次のオプションは、tar の基本的な動作を指定するオプションで、いずれかを必ず指定しなければならない。tar の基本動作を変えたい場合は、後述の追加オプションを組み合わせて使う。オプションによっては、その直後に空白を 1 つ挿入して引数が指定可能にしなければならないものがある。</p>
<p>-c(+create)</p>
<p>引数として指定したファイル名を生成する。引数を省略した場合は、現在作業しているディレクトリの全ファイルを生成する。いずれの場合にも同じファイル名が存在すると、上書きされる。</p>
<p>-d(+compare または +diff)</p>
<p>引数として指定したアーカイブ・ファイルとファイル・システムのファイルを比較し、ファイルの大きさやモード、所有者、内容を表示する。引数を省略した場合は、全アーカイブ・ファイルを比較する。</p>
<p>-r(+append)</p>
<p>引数として指定したファイルを、tar が解釈できるアーカイブの最後に追加する。引数のファイル名は省略できない。</p>
<p>-t(+list)</p>
<p>アーカイブ・ファイルのリストを表示する。引数にファイル名を指定した場合は、それだけのリストを表示する。</p>
<p>-u(+update)</p>
<p>-r オプションと似ている。ただし、引数として指定したファイルが、アーカイブの中に存在しない場合やアーカイブの中のバージョンより新しい場合にのみ動作する。引数のファイル名は省略できない。</p>
<p>-x(+extract または +get)</p>
<p>引数として指定したファイルをアーカイブから取り出す。引数を省略した場合は、アーカイブの全ファイルを取り出す。</p>
<p>-A(+catenate または +concatenate)</p>
<p>複数のアーカイブ・ファイルを 1 つにまとめる場合に使う。対象ファイルは全てアーカイブ・ファイルであること。それら全てを作業中のファイルに追加する (対象ファイルは変更しない)。cat コマンドを使ってみたくなるかもしれないが、動作しない。tar のアーカイブの最後には終了のデータが入るが、cat で追加したものにはそれが入らないので無視される。追加されるアーカイブ・ファイルの最後の終了データを取り除いているので正しく動作する。</p>
<p>-D(+delete)</p>
<p>幾つかのアーカイブから削除する。非常に遅い。ただし、磁気テープからファイルを削除する場合は、アーカイブを再書き込みすること。このコマンドを磁気テープのアーカイブに使うと、データがめちゃくちゃになるので、その場合にはアーカイブ・ファイルを完全に書き直す必要がある。</p>
</dd>
<dt>●追加オプション</dt>
<dd>
<p>　次のオプションは、前述の基本オプションと組み合わせて使い、tar の基本動作を変更するために用いる。オプションの直後に空白を 1 つ挿入して引数を指定する。</p>
</dd>
<dt>●いつでも使えるオプション</dt>
<dd>
<p>-b(+block-size)N</p>
<p>N ブロッキング・ファクタを指定する。N×512 バイトのブロック単位にアーカイブの読み書きを行なう。既定のブロッキング・ファクタは通常、20 である。媒体が磁気テープの場合は、大きめのブロックを指定すると、(内部レコードのギャップがほとんどないので) テープに多くのデータを入れられ高いスループットが得られる。ハード (フロッピー)・ディスクの場合は、アーカイブの最後に、多くのヌル・バイトが追加されるので、小さめのブロッキング・ファクタを指定する。</p>
<p>カートリッジ・テープやその他のストリーマ・テープの場合は、かなり大きめのブロッキング・ファクタ (126 上) を指定すると効率が非常に良くなる。ただし、アーカイブの読み込みや更新時には同じブロッキング・ファクタを指定すること。</p>
<p>-f(+file)FileName</p>
<p>FileName にはアーカイブ先のファイル名を指定する。このオプションの指定がなく、環境変数 TAPE が設定されている場合は、その環境変数値が使われる。そうでない場合は、(tar のコンパイル時に選択した) アーカイブ名が使われる (既定値)。その既定値には通常、最初のテープ・ドライブか、あるいはシステム上の転送可能なその他の I/O 媒体が設定されている。FileName を - とした場合は、標準入力からの読み込みか、または標準出力への書き出しとなる。</p>
<p>FileName に :/dev/ を含む場合は、「ホスト名 : ファイル名」の形式として解釈される。ホスト名に　@　が含まれていると、「user@ ホスト名 : ファイル名」の形式として扱う。任意のログイン名を指定した場合は、rsh を起動するので、4.3BSD 以外システム上での動作には /etc/rmt を修正する必要がある。<a href="#n.n">◆12</a></p>
<p>-c　または　-C(+directory)Dir</p>
<p>Dir に指定したディレクトリに移ってから、tar を実行する。</p>
<p>-M(+multi-volume)</p>
<p>マルチボリューム・アーカイブ・ファイルを扱う場合にこのオプションを用いる。</p>
<p>-N(+after-date)Date</p>
<p>アーカイブを生成する際に、新しいファイルだけを書き込みたい場合に用いる。取り出す場合は、指定された日付、Date より新しいファイルだけが対象となる。指定日以降の修正や inode の変更時間を持つファイルに対してのみ作用する。</p>
<p>引数に空白の入った日付を指定する場合は引用符で囲むこと。getdate を使って日付の部分を解析しているためである。</p>
<p>-R(+record-number)</p>
<p>普通に表示される各メッセージに、対応するアーカイブのレコード番号をつけて表示する。</p>
<p>複数のテープを必要とするファイル・システムのバックアップ・ログをとる時にも便利である。</p>
<p>-T(+files-from)FileName</p>
<p>対象ファイルのリストを表示する。リストはコマンド引数からではなく、FileName に指定したファイル名の内容からとる。FileName に - を指定した場合は、標準入力から対象リストを読み込む。ただし、-c オプションを使わないで -T - や -f -と組み合わせて使うことはできない。</p>
<p>-v(+verbose)</p>
<p>現在作業中の動作について逐次報告、表示する。</p>
<p>+version</p>
<p>標準エラー出力に対してバージョン番号を表示する。</p>
<p>-w(+interactive)</p>
<p>行なおうとする動作ごとにメッセージを端末に表示し、確認を求める。</p>
<p>標準入力からアーカイブを読み込んでいる場合の tar は、確認のためにファイル /dev/tty を用いる。</p>
<p>-X(+exclude)File</p>
<p>File に指定したファイル名から 1 行ごとにファイル名を表す正規表現を読み込み、その正規表現に一致するファイルを操作対象から外す。</p>
<p>-z または -Z(+compress または +uncompress)</p>
<p>compress プログラムを使って、書き込む時にはアーカイブ・ファイルを圧縮し、読み込み時には非圧縮を施す。</p>
<p>起動する compress に対しての引数は与えられないので、与えたい場合はこのオプションを用いるのではなく、compress を明示的に (パイプと組み合わせて) 実行する。</p>
<p>-z オプションは、-M オプションを使った場合や -u や -r、-A、-D コマンドを使った場合には無効になる。<a href="#n.o">◆13</a></p>
</dd>
<dt>●アーカイブの生成や更新時に使うオプション</dt>
<dd>
<p>-G(+incremental)</p>
<p>ファイル・システムのインクリメンタルなバックアップを行なう。</p>
<p>このオプションを用いると、GNU 版以外の tar プログラムでは読み込むことができないような非標準のアーカイブを生成する。</p>
<p>-h(+dereference)</p>
<p>シンボリック・リンク先のファイルもアーカイブする。ちなみにヘルプの表示は +help オプションを使う。</p>
<p>-l(+one-file-system)</p>
<p>ディレクトリ構造の一部をアーカイブする時に、ファイル・システムの境界 (パーティション) を越えないようにし、そのようなファイルがあった場合にはそれを標準エラー出力で表示する。</p>
<p>Unix の dump コマンドのように、ファイル・システムの全て、あるいは差分バックアップを作成する場合に役立つ。</p>
<p>-o(+old-archive、+old または +portability)</p>
<p>ディレクトリやパイプ、fifo、連続したファイル、デバイス・ファイルに関する情報を入れないで古い形式でアーカイブを書き込む。また、ユーザ名やグループ名ではなく、ユーザ ID やグループ ID の数字を使ってファイルの所有を指定する。</p>
<p>たいていの、古い tar プログラムは新しい形式のアーカイブを読み込むことができるので、アーカイブを更新する場合は、-o を使わないこと。ただし、-o オプションでアーカイブを生成している場合を除く。</p>
<p>-S(+sparse-file)</p>
<p>アーカイブの中に入れた全てのファイルがまばらかどうかをテストし、そうであれば特別なケースとして扱う。</p>
<p>このオプションは dbm ファイルがたくさんある場合に便利である。</p>
<p>-V(+volume)Header</p>
<p>アーカイブ・ファイルの冒頭部分にボリューム・ヘッダーHeader を書き込む。-M オプションと一緒に使う場合は、「Header Volume N」というボリューム・ヘッダーがつく。</p>
<p>-W(+verify)</p>
<p>書き込み後にアーカイブを比較する。全ての相違が標準エラー出力によって報告、表示される。ただし、比較する時はアーカイブがバックスペースの書き込みが可能な媒体に記録されていなければならない。その他のデバイスでは比較できない。</p>
</dd>
<dt>●ファイルのリスト表示や抜き取りのためのオプション</dt>
<dd>
<p>　以下のオプションは　-x や　-t コマンドを使う場合に重要である。</p>
<p>-B(+read-full-blocks)</p>
<p>アーカイブから、あるブロックを読み込もうとしてそのブロック数分を読み込めない場合に、エラーとして扱われないようにする。</p>
<p>-G(+incremental)</p>
<p>アーカイブが差分バックアップを作成するという意味であるが、付随するコマンドによって動作が異なる。</p>
<p>-t と一緒に使う場合は、tar は、アーカイブの各ディレクトリごとに、生成されたディレクトリ内のファイル・リストを表示する。</p>
<p>-x と一緒に使い、ディレクトリのエントリがある場合は、そのディレクトリ上に現存していたとしても、アーカイブでリスト表示されないファイルは全てディレクトリから削除される。</p>
<p>これは、障害のあるファイル・システムをインクリメンタルなバックアップからリストアする場合に役立つ。</p>
<p>-i(+ignore-zeros)</p>
<p>アーカイブのゼロのブロックを無視する。通常、ゼロのブロックとはアーカイブの最後を示すが、障害のあるアーカイブを読み込んでいる時や、幾つかのアーカイブを一緒に cat してアーカイブ・ファイルが生成された場合に、全体のアーカイブを読み込むことができる。<a href="#n.p">◆14</a></p>
<p>このオプションで、複数のファイルが 1 つの物理的なテープに保存される場合の正しく読めないというトラブルを避けることができる。</p>
<p>-k(+keep-old-files)</p>
<p>アーカイブと同じ名前のファイルがあれば上書きする。</p>
<p>-k オプションは　-t と一緒に使うと無効になる。</p>
<p>-K(+starting-file)FileName</p>
<p>アーカイブの中から指定されたファイル名 FileName を探し、そこから抜き出したり、あるいは FileName のリスト表示を開始する。ディスクが足りないため、指定したファイルの抜き出しに失敗した場合に有効である。</p>
<p>-m(+modification-time)</p>
<p>ファイルが抜き出された時間を、ファイルの修正時間とする。</p>
<p>-t と一緒に使うと無効になる。</p>
<p>-O(+to-stdout)</p>
<p>標準出力に抜き出されたファイルの内容を書き込む。抜き出して、ファイルの内容をパイプ機能で送るといった場合に役立つ。</p>
<p>-t と一緒に使うと無効になる。</p>
<p>-p(+same-permissions または +preserve-permissions)</p>
<p>アーカイブに保存した通りにファイルのモード (アクセス許可) を設定する。</p>
<p>-t と一緒に使うと無効になる。</p>
<p>-P(+absolute-paths)</p>
<p>ファイルのパスに絶対パスを指定することができる (省略時では相対パスに直している)。</p>
<p>+preserve</p>
<p>-p と -s を一緒に指定した場合と同等の効果を得る。短いオプション文字は用意されていない。</p>
</dd>
</dl>
<hr/>
<h2>Think GNU  連載第 6 回【脚注】</h2>

<dl>
<dt id="n.a">◆1</dt><dd><p
>当時の忙しさだが、USENIX へ向けて小冊子を翻訳、作成、コンファレンス参加、配布という仕事をこなすためであった。　最近は前述最後の 2 つの項目はほかの人に依頼することが多いのでだいぶ楽になった。</p>
</dd>
<dt id="n.b">◆2</dt><dd><p
>AWL という言語について触れている。これは次の記事も参考になるだろう。</p>
<p>  P. D. Stallmen「Free Software の世界 (17)AWL」「UNIX MAGAZINE」1991 年 1 月号、アスキー</p>
</dd>
<dt id="n.c">◆3</dt><dd><p
>Lisp の方言である Scheme も有望である。使いやすい X 用のパッケージもリリースされているからである。</p>
</dd>
<dt id="n.d">*1</dt><dd><p
>プルダウン・メニュー…メニューの表示方法の 1 種で、メニューあるいはボタンを選んだ所から下に向かってメニューが表示される形式である。その他「ポップアップ・メニュー」形式などがある。</p>
</dd>
<dt id="n.e">◆4</dt><dd><p
>GNU Emacs の欠点として、</p>

<ul>
<li><p>フォントの複数使用不可</p></li>
<li><p>スクロール・バーやボタンの未サポート</p></li>
<li><p>メニューが不十分</p></li>
</ul>

<p>といった点をあげているが、Epoch や Emacs バージョン 19 では一部あるいは全部をサポートしている (バージョン 19 はまだリリースされてはいない)。</p>
<p>Lucid 社がバージョン 19 の FSF の作業バージョンをベースにした lemacs19 では上述の点をサポートしている。</p>
</dd>
<dt id="n.f">◆5</dt><dd><p
>ミニコンピュータ上で Emacs を使っていた時代の Emacs ユーザは少数派であった。Emacs を使っていることがすぐわかってしまう。だいぶ後ろからでも端末を見れば、たいていウィンドウが 2 つに分かれているからである。それで当時上司から何度か注意を受けた思い出がある。</p>
</dd>
<dt id="n.g">◆6</dt><dd><p
>GNU 宣言については、第 2 部を参照のこと。</p>
</dd>
<dt id="n.h">*2</dt><dd><p
>コアダンプ…プログラムが不正な領域をアクセスしたりゼロの除算を行なうと Unix の世界では、カーネルがそのプログラムのメインメモリやレジスタなどプロセスごとのデータ構造の内容をファイルに書き込む機能を有する。これをコア・ファイルと呼ぶ。計算機のメインメモリが、半導体メモリではなく磁気メモリや磁気コアであったころの呼び名の名残りである。これ以外によく目につくのは tty という文字である。これはテレタイプの略でテレックス用の電動タイプライタに端を発すると記憶している。今ではファックスに押され、テレックスも見かけなくなった。</p>
</dd>
<dt id="n.i">◆7</dt><dd><p
>「マルチボリューム」とは複数個の媒体のことで、GNU tar では 1 つの媒体に入りきれないアーカイブを複数に分けることができる。</p>
</dd>
<dt id="n.j">◆8</dt><dd><p
>現在、GNU 一般公有使用許諾と呼んでいる。</p>
</dd>
<dt id="n.k">◆9</dt><dd><p
>電卓と呼んでいるものの機能的には完全な数式処理システムである。</p>
</dd>
<dt id="n.l">◆10</dt><dd><p
>「任意の数 M を法とした演算」とは、{0, 1,　　. .　. ,　M-1} の有限個の要素を対象に行なう演算のこと。</p>
</dd>
<dt id="n.m">◆11</dt><dd><p
>「長いオプション名」(long named option) とは、オプションにわかりやすい (理解しやすくするために) 英単語を採用したものである。Unix のオプション名は一般的に、-(マイナス記号) で始まる 1 文字であった。プロジェクト GNU　では全てのコマンドに対して意味そのもので覚えやすい長いオプション名も使えるようにしている。</p>
</dd>
<dt id="n.n">◆12</dt><dd><p
>ローカルにファイルがあるのではなくリモート・ホストにあるものと解釈される。</p>
</dd>
<dt id="n.o">◆13</dt><dd><p
>GNU tar の `-X File' オプションについて補足する。アーカイブするファイルを指定したり、あるいは取り出すファイルを指定する際に、このコマンドでそれらの操作対象から外す。外すファイル名を正規表現で表した行を File に入れておけばよい。複数行与えられる。</p>
<p>　例えば、</p>

<pre>
$ tar -c -X exFile
</pre>

<p>というコマンドを実行する場合を考える。exFile には次のような行が入っているとする。</p>

<pre>
*〜
#*
</pre>

<p>そうすると現在注目しているディレクトリより下のもの全てをアーカイブする。ただし、〜 で終了しているファイルと # で開始しているファイル名は除外する。</p>
</dd>
<dt id="n.p">◆14</dt><dd><p
>「cat コマンドで連結する」という意味である。</p>
</dd>
</dl>
<hr/>
<ul>
<li><a href="../orig/copying">取り扱い注意</a></li>
<li><a href="tga07.html">次→</a></li>
<li><a href="tga05.html">←前</a></li>
<li><a href="tga00.html">まえがき、目次</a></li>
<li><a href="../">(HTML版)Think GNU配布</a></li>
</ul>
</body></html>
